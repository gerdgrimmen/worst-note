<!DOCTYPE html>
<html lang="en">
    <head>
        <style>
body {background-color: powderblue;}
#taglist {background-color: cyan; min-width: 50px; min-height: 50px;}
#notelist {background-color: yellow; min-width: 50px; min-height: 50px;}
.tag {background-color: red; margin: 5px;}
.note {background-color: blue; margin: 5px;}
        </style>
    </head>
    <body>
        <!-- fullnote -->
        <div id="fullnote_output">
            <div id="fullnote_title">
                
            </div>
            <div id="fullnote_tag" style="display: flex;">

            </div>
            <div id="fullnote_notes">

            </div>
        </div>
        <div style="display: inline-block;min-height: 250px;background-color: bisque;">            
            <div>
                <!-- input new title -->
                <label for="newtitle">New Title:</label><br>
                <input type="text" name="newtitle" size="20" id="newtitle_input"/>
                <!-- button new title -->
                <input type="button" value="Add Note" id="newtitle_button"/>
            </div>
            <div>
                <!-- input new note -->
                <label for="newnote">New Note:</label><br>
                <textarea name="newnote" cols="40" rows="5" id="newnote_input"></textarea>
                <!-- button new note -->
                <input type="button" value="Add Note" id="newnote_button"/>
            </div>
            <div>
                <!-- input new tag -->
                <label for="newtag">New Tag:</label><br>
                <input type="text" name="newtag" size="20" id="newtag_input"/>
                <!-- button new tag -->
                <input type="button" value="Add Tag" id="newtag_button"/>
            </div>
        </div>

        <script type="text/javascript">
            var newtitle_input = document.getElementById("newtitle_input");
            var newtitle_button = document.getElementById("newtitle_button");
            var newnote_input = document.getElementById("newnote_input");
            var newnote_button = document.getElementById("newnote_button");
            var newtag_input = document.getElementById("newtag_input");
            var newtag_button = document.getElementById("newtag_button");
            
            var fullnote_title = document.getElementById("fullnote_title");
            var fullnote_notes = document.getElementById("fullnote_notes");
            var fullnote_tag = document.getElementById("fullnote_tag");

            var data_structure = {"notes": [], "tags": [], "images": {}, "fullnotes": {"01": {}}};

            function write_data_to_localStorage(){
                localStorage.setItem("data_structure", JSON.stringify(data_structure));
            }

            function update_title(){

                fullnote_title.innerText = data_structure["fullnotes"]["01"]["title"];
            }
            
            function update_notes(){
                fullnote_notes.innerHTML = ""
                var count = 0;
                data_structure["notes"].forEach(function(element){
                    fullnote_placement("note", count, element);
                    count = count + 1;
                });
            }
            
            function update_tags(){
                fullnote_tag.innerHTML = ""
                var count = 0;
                data_structure["tags"].forEach(function(element){
                    fullnote_placement("tag", count, element);
                    count = count + 1;
                });
            }
            
            function add_title(){
                data_structure["fullnotes"]["01"]["title"] = newtitle_input.value;
                update_title()
                write_data_to_localStorage()
                newtitle_input.value = "";
            }
            async function add_note(){
                var length = data_structure["notes"].keys().length;
                data_structure["notes"].push(newnote_input.value);
                update_notes();
                write_data_to_localStorage();
                newnote_input.value = "";
            };
            async function add_tag(){
                var length = data_structure["tags"].keys().length;
                data_structure["tags"].push(newtag_input.value);
                update_tags();
                write_data_to_localStorage();
                newtag_input.value = "";
            };
            
            function fullnote_placement(type, key, value){
                switch(type){
                    case "note":
                        var new_div = document.createElement("div");
                        new_div.classList.add("note");
                        new_div.innerText = value;
                        fullnote_notes.appendChild(new_div);
                        console.log(fullnote_notes);
                        break;
                    case "image":
                        var new_div = document.createElement("div");
                        new_div.classList.add("image");
                        new_div.innerText = value;
                        fullnote_notes.appendChild(new_div);
                        console.log(fullnote_notes);
                        break;
                    case "tag":
                        if (data_structure["tags"].includes(key)){
                            break;
                        }
                        var new_div = document.createElement("div");
                        new_div.classList.add("tag");
                        new_div.innerText = value;
                        fullnote_tag.appendChild(new_div);
                        console.log(fullnote_tag);
                        break;
                    default:
                        break;
                }
            }

            newtitle_button.addEventListener("click", add_title);
            newnote_button.addEventListener("click", add_note);
            newtag_button.addEventListener("click", add_tag);
            
            // localStorage.removeItem("data_structure");
            if (localStorage.getItem("data_structure") !== null){
                
                data_structure = JSON.parse(localStorage.getItem("data_structure"));
                console.log("loading old state");
                console.log(data_structure)
                console.log(data_structure["fullnotes"])
            }
            console.log(localStorage);
            update_title();
            update_notes();
            update_tags();
        </script>
    </html>
</body>
